---
title: "민주화 이후 한국 재보궐 선거데이터 코드북 (국회의원 선거)"
subtitle: "Coodbook for Re/By-Election of South Korea (General Elections)"
author: "Sanghoon Park"
date: "`r format(Sys.time(), '%Y-%b-%d')`"
output: 
  pdf_document:
    latex_engine: xelatex
    toc: TRUE
header-includes:
- \usepackage{kotex}
- \usepackage{setspace}
- \doublespacing
- \usepackage{float}
- \usepackage{longtable}
mainfont: NanumMyeongjo
fontsize: 12pt
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F,
                      fig.pos="htbp")
knitr::opts_chunk$set(fig.showtext=TRUE)
library(showtext)
font_add_google(name = "Nanum Myeongjo", family = "nanummyeongjo")
library(tidyverse);library(ezpickr);library(googlesheets4)
reby_election <- googlesheets4::read_sheet("https://docs.google.com/spreadsheets/d/1doUuNVPYW6t0ie7PbVBYFxcTkG6QYl0KFB0mj9BqGxc/edit?usp=sharing")
theme_mfx <- function() {
  theme_minimal(base_family = "nanummyeongjo") +
    theme(panel.grid.minor = element_blank(),
      plot.background = element_rect(fill = "white", color = NA),
      plot.title = element_text(face = "bold"),
      axis.title = element_text(face = "bold"),
      strip.text = element_text(face = "bold"),
      strip.background = element_rect(fill = "grey80", color = NA),
      legend.title = element_text(face = "bold"))
}

ggplot2::theme_set(theme_mfx())

```

# Data Descriptions
## 재보궐 선거 변수

**ELEC_DATE**

: 선거일(DATE), 재보궐선거가 실시된 연-월-일 (1989년 6월 민주화 이후의 시점(1989-08-18)부터 현재(`r format(Sys.time(), '%Y-%b-%d')`)까지 최신화).

```{r, fig.height=6.5, fig.width=6, fig.cap = "재보궐 선거의 추이"}
reby_election %>% group_by(ELEC_DATE) %>% 
  count() %>% dplyr::filter(n>0) %>%
  ggplot(aes(x = as.character(ELEC_DATE), y = n)) + 
  geom_col() + coord_flip() + 
  labs(x = "", y = "선거 횟수")
```

ELEC_TYPE

: 선거유형(CHR), 선출유형에 따른 분류 (현재는 국회의원만 코딩).

CITY

: 시도(CHR), 시도 구분.

DISTRICT

: 선거구(CHR), 선거구명.

ELEC_POP

: 선거인수(NUM), 총 유권자 수.

ELEC_VOTER

: 투표수(NUM), 총 투표인 수.

ELEC_RESIGN

: 기권자수(NUM) 총 유권자 수 - 총 투표인 수.

ELEC_TURNOUT

: 투표율(NUM) 총 투표인 수 / 총 유권자 수 * 100.

```{r, fig.width=8, fig.height=3, fig.cap = "재보궐 선거 투표율 변수의 분포"}
reby_election %>%
  ggplot(aes(ELEC_TURNOUT)) + 
  geom_density(
    color = futurevisions::futurevisions("mars")[1],
    fill = futurevisions::futurevisions("mars")[1],
    alpha = 0.4
  ) + labs(y = "밀도", x = "재보궐 선거 투표율(%)") -> panel1

reby_election %>%
  ggplot(aes(log(ELEC_TURNOUT/(100-ELEC_TURNOUT)))) + 
  geom_density(
    color = futurevisions::futurevisions("mars")[3],
    fill = futurevisions::futurevisions("mars")[3],
    alpha = 0.4
  ) + labs(y = "", x = "ln(재보궐 선거 투표율/(100-재보궐 선거 투표율))") -> panel2

library(patchwork)
panel1 + panel2 + plot_layout(ncol = 2)

```

ELEC_REASON

: 사유(FCT) 재보궐 시행 사유.

```{r, fig.width=6, fig.height=2, fig.cap = "재보궐 선거 사유"}
reby_election %>%
  ggplot(aes(ELEC_REASON, fill = ELEC_REASON)) + 
  geom_bar(show.legend = F) + 
  labs(y = "빈도", x = "") + 
  viridis::scale_fill_viridis(discrete = T)
```


```{r, fig.width=6, fig.height=2, fig.cap = "재보궐 시행 사유별 투표율"}
reby_election %>%
  ggplot(aes(ELEC_TURNOUT*0.01, fill = ELEC_REASON)) + 
  geom_boxplot(
    alpha = 0.8, show.legend = F
  ) + labs(y = NULL, x = "재보궐 선거 투표율") + 
  viridis::scale_fill_viridis(discrete = T) +
  viridis::scale_color_viridis(discrete = T) +
  scale_x_continuous(labels = scales::percent_format(), limits = c(0, 1)) +
  facet_wrap(~ELEC_REASON, ncol = 7) + coord_flip() + 
  theme(axis.text.x = element_blank())
```

ELEC_COMPETE

: 재보궐경쟁률(NUM), 100 * (2위 득표자 득표율 / 해당 재보궐 선거에서 당선자 득표율).

```{r, fig.width=6, fig.height=2, fig.cap = "재보궐 선거 경쟁률의 분포"}
reby_election %>%
  ggplot(aes(ELEC_COMPETE)) + 
  geom_density(
    color = futurevisions::futurevisions("mars")[1],
    fill = futurevisions::futurevisions("mars")[1],
    alpha = 0.4
  ) + labs(y = "밀도", x = "재보궐 선거 경쟁률")
```

```{r, fig.width=6, fig.height=2, fig.cap = "재보궐 시행 사유별 경쟁률"}
reby_election %>%
  ggplot(aes(ELEC_COMPETE*0.01, fill = ELEC_REASON)) + 
  geom_boxplot(
    alpha = 0.8, show.legend = F
  ) + labs(y = NULL, x = "재보궐 선거 경쟁률") + 
  viridis::scale_fill_viridis(discrete = T) +
  viridis::scale_color_viridis(discrete = T) +
  scale_x_continuous(labels = scales::percent_format(), limits = c(0, 1)) +
  facet_wrap(~ELEC_REASON, ncol = 7) + coord_flip() + 
  theme(axis.text.x = element_blank())
```


ELEC_CANDINUM

: 재보궐후보자수(NUM), 해당 재보궐 선거에 참여한 후보의 수.

ELEC_EFFECTNUM

: 재보궐 유효후보자수(NUM), 해당 재보궐 선거에 참여한 득표율 3% 이상의 유효후보의 수.

## 재보궐 당선자 변수

ELEC_PARTY

: 당선자당적(CHR) 재보궐선거 당선자의 당적.

ELEC_ELECTED

: 당선자명(CHR), 재보궐선거 당선자의 이름.

ELEC_GENDER

: 당선자 성별(CHR), 재보궐선거 당선자의 성별 (남/여).

ELEC_SHARE

: 당선자득표율(NUM), 재보궐 선거 당선자의 득표율.

ELEC_NUMBER

: 선수(NUM), 재보궐 선거 당선자의 당선 당시 선수 (초선/재선/3선 등).

## 재보궐 2위득표자 변수

RIVAL_PARTY

: 2위득표자당적(CHR), 재보궐 선거 2위 득표자의 당적.

RIVAL_NAME

: 2위득표자명(CHR), 재보궐 선거 2위 득표자의 이름.

RIVAL_GENDER

: 2위득표자성별(CHR), 재보궐선거 2위 득표자의 성별 (남/여).

RIVAL_SHARE

: 2위득표자득표율(NUM), 재보궐 선거 2위 득표자의 득표율.

## 재보궐 선거 직전 총선 변수

PRE_POP

: 직전총선선거인수(NUM), 해당 재보궐 선거 직전의 총선을 대상으로 선거통계시스템에서 인용한 총 선거인 수.

PRE_VOTER

: 직전총선투표인수(NUM), 해당 재보궐 선거 직전의 총선을 대상으로 선거통계시스템에서 인용한 총 투표인 수.

PRE_RESIGN

: 직전총선기권자수(NUM), 해당 재보궐 선거 직전의 총선을 대상으로 계산한 기권자 수: 선거인 수 - 총 투표인 수.

PRE_TURNOUT

: 직전총선투표율(NUM), 해당 재보궐 선거 직전의 총선을 대상으로 계산한 투표율: 총 투표인 수 / 총 유권자 수 * 100, 소수점 둘째자리로 반올림.

```{r, fig.width=8, fig.height=3, fig.cap = "재보궐 선거 직전 총선 투표율 변수의 분포"}
reby_election %>%
  ggplot(aes(PRE_TURNOUT)) + 
  geom_density(
    color = futurevisions::futurevisions("mars")[1],
    fill = futurevisions::futurevisions("mars")[1],
    alpha = 0.4
  ) + labs(y = "밀도", x = "재보궐 선거 직전 총선 투표율(%)") -> panel3

reby_election %>%
  ggplot(aes(log(PRE_TURNOUT/(100-PRE_TURNOUT)))) + 
  geom_density(
    color = futurevisions::futurevisions("mars")[3],
    fill = futurevisions::futurevisions("mars")[3],
    alpha = 0.4
  ) + labs(y = "", x = "ln(직전 총선 투표율/(100-직전 총선 투표율))") -> panel4

panel3 + panel4 + patchwork::plot_layout(ncol = 2)
```

PRE_PARTY

: 직전당선자당적(CHR), 해당 재보궐 선거 직전에 당선자의 당적.

PRE_ELECTED

: 직전당선자(CHR), 해당 재보궐 선거 직전에 당선된 자의 이름.

PRE_SHARE

: 직전총선당선득표율(NUM), 해당 재보궐 선거 직전의 총선에서 당선자의 득표율.

PRE_RIVAL_SHARE

: 직전총선2위득표율(NUM), 해당 재보궐 선거 직전의 총선에서 2위 득표자의 득표율.

PRE_COMPETE

: 직전선거경쟁률(NUM), 100 * (2위 득표자 득표율 / 해당 재보궐 선거 직전의 총선에서 당선자 득표율).

```{r, fig.width=6, fig.height=2, fig.cap = "재보궐 직전 총선 경쟁률의 분포"}
reby_election %>%
  ggplot(aes(PRE_COMPETE)) + 
  geom_density(
    color = futurevisions::futurevisions("mars")[2],
    fill = futurevisions::futurevisions("mars")[2],
    alpha = 0.4
  ) + labs(y = "밀도", x = "재보궐 직전 총선 경쟁률")
```

PRE_CANDINUM

: 직전선거후보자수(NUM), 해당 재보궐 선거 직전의 총선에 참여한 후보의 수.

PRE_EFFECTNUM

: 직전선거 유효후보자수(NUM), 해당 재보궐 선거 직전의 총선에 참여한 득표율 3% 이상의 유효후보의 수.

```{r, fig.width=8, fig.height=4, fig.cap = "재보궐 선거 직전 총선 투표율과 재보궐 선거 투표율 간 관계"}
reby_election %>%
  ggplot(aes(x = PRE_TURNOUT, y = ELEC_TURNOUT)) + 
  geom_point(
    color = futurevisions::futurevisions("mars")[1],
    fill = futurevisions::futurevisions("mars")[1],
    alpha = 0.4
  ) + 
  geom_abline(intercept = 0, slope = 1, size = 0.5) +
  geom_smooth(method = "lm", se = F, fullrange=TRUE,
              color = futurevisions::futurevisions("mars")[1]) + 
  scale_x_continuous(limits = c(0, 100)) +
  scale_y_continuous(limits = c(0, 100)) + 
  labs(y = "재보궐 투표율(%)", x = "재보궐 직전 총선 투표율(%)") -> panel7

reby_election %>%
  ggplot(aes(x = PRE_COMPETE, y = ELEC_COMPETE)) + 
  geom_point(
    color = futurevisions::futurevisions("mars")[3],
    fill = futurevisions::futurevisions("mars")[3],
    alpha = 0.4
  ) + 
  geom_abline(intercept = 0, slope = 1, size = 0.5) +
  geom_smooth(method = "lm", se = F, fullrange=TRUE,
              color = futurevisions::futurevisions("mars")[3]) + 
  scale_x_continuous(limits = c(0, 100)) +
  scale_y_continuous(limits = c(0, 100)) + 
  labs(y = "재보궐 경쟁률(%)", x = "재보궐 직전 총선 경쟁률(%)") -> panel8

panel7 + panel8 + patchwork::plot_layout(ncol = 2)

```

## 재보궐 선거 직후 총선 변수

POST_POP

: 직후총선선거인수(NUM), 해당 재보궐 선거 직후의 총선을 대상으로 선거통계시스템에서 인용한 총 선거인 수.

POST_VOTER

: 직후총선투표인수(NUM), 해당 재보궐 선거 직후의 총선을 대상으로 선거통계시스템에서 인용한 총 투표인 수.

POST_RESIGN

: 직후총선기권자수(NUM), 해당 재보궐 선거 직후의 총선을 대상으로 계산한 기권자 수: 선거인 수 - 총 투표인 수.

POST_TURNOUT

: 직후총선투표율(NUM), 해당 재보궐 선거 직후의 총선을 대상으로 계산한 투표율: 총 투표인 수 / 총 유권자 수 * 100, 소수점 둘째자리로 반올림.

```{r, fig.width=8, fig.height=3, fig.cap = "재보궐 선거 직후 총선 투표율 변수의 분포"}
reby_election %>%
  ggplot(aes(PRE_TURNOUT)) + 
  geom_density(
    color = futurevisions::futurevisions("mars")[1],
    fill = futurevisions::futurevisions("mars")[1],
    alpha = 0.4
  ) + labs(y = "밀도", x = "재보궐 선거 직후 총선 투표율(%)") ->
  panel5

reby_election %>%
  ggplot(aes(log(PRE_TURNOUT/(100-PRE_TURNOUT)))) + 
  geom_density(
    color = futurevisions::futurevisions("mars")[3],
    fill = futurevisions::futurevisions("mars")[3],
    alpha = 0.4
  ) + labs(y = "", x = "ln(직후 총선 투표율/(100-직후 총선 투표율))") -> panel6

panel5 + panel6 + plot_layout(ncol = 2)
```

POST_PARTY

: 직후당선자당적(CHR), 해당 재보궐 선거 직후의 총선에서 당선자의 당적.

POST_ELECTED

: 직후당선자(CHR), 해당 재보궐 선거 직후의 총선에서 당선자의 이름.

POST_SHARE

: 직후총선당선득표율(NUM), 해당 재보궐 선거 직후의 총선에서 당선자의 득표율.

POST_RIVAL_SHARE

: 직후총선2위득표율(NUM), 해당 재보궐 선거 직후의 총선에서 2위 득표자의 득표율.

POST_COMPETE

: 직후총선경쟁률(NUM), 100 * (2위 득표자 득표율 / 해당 재보궐 선거 직후의 총선에서 당선자 득표율).

```{r, fig.width=6, fig.height=2, fig.cap = "재보궐 직후 총선 경쟁률의 분포"}
reby_election %>%
  ggplot(aes(POST_COMPETE)) + 
  geom_density(
    color = futurevisions::futurevisions("mars")[3],
    fill = futurevisions::futurevisions("mars")[3],
    alpha = 0.4
  ) + labs(y = "밀도", x = "재보궐 직후 총선 경쟁률")
```

POST_CANDINUM

: 직후선거후보자수(NUM), 해당 재보궐 선거 직후의 총선에 참여한 후보의 수.

POST_EFFECTNUM

: 직후선거 유효후보자수(NUM), 해당 재보궐 선거 직후의 총선에 참여한 득표율 3% 이상의 유효후보의 수.

## 기타 선거 관련 변수

GENERAL_DATE

: 인접총선일자(DATE), 재보궐 선거로부터 가장 가까운 미래 인접 총선의 일자.

GENERAL_DIFF

: 인접총선일자차이(NUM), 인접총선일자 - 선거일.

GENERAL_TENURE

: 의회임기_남은햇수(NUM), 재보궐 선거 당시 남은 의회 임기(햇수).

PRESIDENT_DATE

: 인접대선일자(DATE), 재보궐 선거로부터 가장 가까운 미래 인접 대선의 일자.

PRESIDENT_DIFF

: 인접대선일자차이(NUM), 인접대선일자 - 선거일.

PRESIDENT_TENURE

: 대통령임기_남은햇수(NUM), 재보궐 선거 당시 남은 대통령 임기(햇수).

PRESIDENT_POSITIVE

: 대통령_평가(긍정)(NUM), 재보궐선거가 실시된 시점 이전의 시기에서 가장 근접한 시점에 조사된 여론조사 전문기관인 한국갤럽이 조사한 주차별 대통령 국정운영 지지율(긍정).

PRESIDENT_NEGATIVE

: 대통령_평가(부정)(NUM), 재보궐선거가 실시된 시점 이전의 시기에서 가장 근접한 시점에 조사된 여론조사 전문기관인 한국갤럽이 조사한 주차별 대통령 국정운영 지지율(부정).

```{r, fig.width=6, fig.height=3.5, fig.cap = "대통령 평가 (긍정/부정)"}

reby_election %>% 
  dplyr::select(ELEC_DATE, PRESIDENT_POSITIVE, PRESIDENT_NEGATIVE) %>%
  tidyr::gather(PRESIDENT, SCORE, -ELEC_DATE) %>%
  mutate(PRESIDENT = case_when(
    PRESIDENT == "PRESIDENT_NEGATIVE" ~ "부정",
    PRESIDENT == "PRESIDENT_POSITIVE" ~ "긍정",
  )) -> reby_election_long
reby_election_long %>%
  ggplot(aes(x = ELEC_DATE, y = SCORE, group = PRESIDENT,
             color = PRESIDENT)) + 
  scale_color_manual(values = c(futurevisions::futurevisions("mars")[3],
                                futurevisions::futurevisions("mars")[1])) + 
  labs(y = "지지율 (%)", x = "") + 
  geom_line() +  geom_point(fill = "white", shape = 21, size = 3) +
  theme(legend.position = "bottom")
```

REGIONALISM

: 지역주의(FCT), 재보궐 선거가 실시된 지역을 기준으로 지역주의 코딩 (1 = PK (부울경) / 2 = TK (대구경북) / 3 = HN (호남) / 4 = 기타).

RULINGPARTY

: 여당(CHR), 재보궐 선거가 실시된 시점의 여당이름.

RULINGAPPROVAL

: 여당지지도(NUM), 재보궐 선거가 실시된 시점 이전의 시기에서 가장 근접한 시점에 조사된 여론조사 전문기관인 리서치앤리서치(R&R)가 조사한 여당지지율.

PRE_ELEC_CANDI_DIFF

: 직전재보궐후보자수차이(NUM), 재보궐 선거에 참여한 후보자 수 - 해당 재보궐 선거 직전의 총선에 참여한 후보의 수.

POST_ELEC_CANDI_DIFF

: 직후재보궐후보자수차이(NUM), 해당 재보궐 선거 직후의 총선에 참여한 후보의 수 - 재보궐 선거에 참여한 후보자 수.

PRE_ELEC_SHIFT

: 재보궐전교체(NUM), 재보궐 이전 총선의 당선자로부터 재보궐 선거 당선자의 당적이 교체된 경우 (이항변수; 1, 0).

POST_ELEC_SHIFT

: 재보궐이후교체(NUM), 재보궐 선거 당선자로부터 재보궐 이전 총선의 당선자의 당적이 교체된 경우 (이항변수; 1, 0).

PRE_ELEC_COMPETE_DIFF

: 직전보궐경쟁률차이(NUM), 재보궐경쟁률 - 직전선거경쟁률.

POST_ELEC_COMPETE_DIFF

: 직후보궐경쟁률차이(NUM), 직후선거경쟁률 - 재보궐경쟁률.

PRE_ELEC_SHIFT2

: 의석교체(FCT), 여당, 직전당선자당적과 당선자당적 변수를 바탕으로 1 = 여당 $\rightarrow$ 여당 / 2 = 여당 $\rightarrow$ 야당 / 3 = 야당 $\rightarrow$ 여당 / 4 = 야당 $\rightarrow$ 야당.

ELEC_RULING

: 여당유리지역주의(FCT), 선거 당시 여당을 지지하는 지역주의에 선거구가 위치하고 있으면 1 아니면 0.

ELEC_OPPOSITION

: 야당유리지역주의(FCT), 선거 당시 야당을 지지하는 지역주의에 선거구가 위치하고 있으면 1 아니면 0.

PREVOTE

: 사전투표제 도입 여부(NUM), 사전투표제도가 도입된 2013년도 상반기 재·보궐선거 이후 선거일 경우 1, 아니면 0.

```{r, fig.width=8, fig.height=4, fig.cap = "사전투표제도 도입 전후 재보궐선거 투표율 비교(평균)"}

# p value between first two bars
p_value_one <- tibble(
  x = c(0, 0, 1, 1),
  y = c(44, 52, 52, 50))

reby_election %>% 
  dplyr::select(ELEC_TURNOUT, PREVOTE) %>%
  group_by(PREVOTE) |>
  summarize(mean = mean(ELEC_TURNOUT, na.rm = T),
            sd = sd(ELEC_TURNOUT, na.rm = T),
            n = n(),
            se = sd/sqrt(n)) -> 
  summarized

t.test2 <- function(m1,m2,s1,s2,n1,n2,m0=0,equal.variance=FALSE)
{
    if( equal.variance==FALSE ) 
    {
        se <- sqrt( (s1^2/n1) + (s2^2/n2) )
        # welch-satterthwaite df
        df <- ( (s1^2/n1 + s2^2/n2)^2 )/( (s1^2/n1)^2/(n1-1) + (s2^2/n2)^2/(n2-1) )
    } else
    {
        # pooled standard deviation, scaled by the sample sizes
        se <- sqrt( (1/n1 + 1/n2) * ((n1-1)*s1^2 + (n2-1)*s2^2)/(n1+n2-2) ) 
        df <- n1+n2-2
    }      
    t <- (m1-m2-m0)/se 
    dat <- c(m1-m2, se, t, 2*pt(-abs(t),df))    
    names(dat) <- c("Difference of means", "Std Error", "t", "p-value")
    return(dat) 
}

# t.test2(summarized$mean[2], summarized$mean[1], summarized$sd[2],summarized$mean[1], summarized$n[2], summarized$n[1])

summarized |> full_join(p_value_one,
                        by = c("PREVOTE" = "x")) -> full_sum
  ggplot(
    data = full_sum[c(1, 3),],
    aes(x = PREVOTE, y = mean*0.01, 
             group = as.factor(PREVOTE),
             fill = as.factor(PREVOTE),
             color = as.factor(PREVOTE))) + 
  geom_bar(stat = "identity", show.legend = F) + 
  geom_text(aes(label = paste0(round(mean*0.01, 2)*100, "%")), 
            position = position_stack(0.8), color = "white") + 
    
  # add this for your bar plot
  geom_line(
    data = full_sum,
    aes(x = PREVOTE, y = y*0.01, group = 1), show.legend = F,
    color = "black") +
  annotate("text", x = 0.5, y = 0.55, 
           label = "통계적으로 유의미한 차이가 없음 (t = 1.49; p-value = 0.14)",
           size = 4, color = "#22292F") +
  scale_y_continuous(labels = scales::percent_format()) + 
  scale_x_continuous(breaks = c(0, 1), labels = c("사전투표제 전 (n = 95)", "사전투표제 후 (n = 49)")) + 
  scale_color_manual(values = c(futurevisions::futurevisions("mars")[3],
                                futurevisions::futurevisions("mars")[1])) +
  scale_fill_manual(values = c(futurevisions::futurevisions("mars")[3],
                                futurevisions::futurevisions("mars")[1])) + 
  labs(y = "투표율 (%)", x = NULL) + 
  theme(legend.position = "bottom")
```

```{r, fig.width=8, fig.height=4, fig.cap = "사전투표제도 도입 전후 재보궐선거 경쟁률 비교(평균)"}

# p value between first two bars
p_value_two <- tibble(
  x = c(0, 0, 1, 1),
  y = c(70, 72, 72, 65))

reby_election %>% 
  dplyr::select(ELEC_COMPETE, PREVOTE) %>%
  group_by(PREVOTE) |>
  summarize(mean = mean(ELEC_COMPETE, na.rm = T),
            sd = sd(ELEC_COMPETE, na.rm = T),
            n = n(),
            se = sd/sqrt(n)) -> 
  summarized_compete

# t.test2(summarized_compete$mean[2], summarized_compete$mean[1], summarized_compete$sd[2],summarized_compete$mean[1], summarized_compete$n[2], summarized_compete$n[1])

summarized_compete |> full_join(p_value_two,
                        by = c("PREVOTE" = "x")) -> full_sum_compete
  ggplot(
    data = full_sum_compete[c(1, 3),],
    aes(x = PREVOTE, y = mean*0.01, 
             group = as.factor(PREVOTE),
             fill = as.factor(PREVOTE),
             color = as.factor(PREVOTE))) + 
  geom_bar(stat = "identity", show.legend = F) + 
  geom_text(aes(label = paste0(round(mean*0.01, 2)*100, "%")), 
            position = position_stack(0.8), color = "white") + 
    
  # add this for your bar plot
  geom_line(
    data = full_sum_compete,
    aes(x = PREVOTE, y = y*0.01, group = 1), show.legend = F,
    color = "black") +
  annotate("text", x = 0.5, y = 0.75, 
           label = "통계적으로 유의미한 차이가 없음 (t = -0.74; p-value = 0.46)",
           size = 4, color = "#22292F") +
  scale_y_continuous(labels = scales::percent_format()) + 
  scale_x_continuous(breaks = c(0, 1), labels = c("사전투표제 전 (n = 95)", "사전투표제 후 (n = 49)")) + 
  scale_color_manual(values = c(futurevisions::futurevisions("mars")[3],
                                futurevisions::futurevisions("mars")[1])) +
  scale_fill_manual(values = c(futurevisions::futurevisions("mars")[3],
                                futurevisions::futurevisions("mars")[1])) + 
  labs(y = "경쟁률 (%)", x = NULL) + 
  theme(legend.position = "bottom")
```

\newpage

# APPENDIX
## 재보궐 선거 지역구에 대한 간략한 정보

```{r}
reby_election %>% 
  dplyr::select(ELEC_DATE, CITY, DISTRICT, ELEC_REASON, ELEC_TURNOUT) %>%
  mutate_if(is.numeric, round, 1) %>%
  group_by(ELEC_DATE, CITY, DISTRICT, ELEC_REASON, ELEC_TURNOUT) %>%
  knitr::kable(
    col.names = c("재보궐 선거일", "시도", "지역구", "재보궐 사유", "투표율"),
    caption = "재보궐선거 지역구 및 재보궐 사유에 대한 정보",
    longtable = T, format = "latex") %>% 
  kableExtra::kable_minimal()
```

## 주요 변수의 기술통계

```{r}
reby_election %>%
  dplyr::select(
    ELEC_RESIGN, ELEC_TURNOUT, ELEC_COMPETE, PRE_RESIGN, PRE_TURNOUT, PRE_COMPETE, POST_RESIGN, POST_TURNOUT, POST_COMPETE
  ) %>%
  psych::describe() -> descriptive
descriptive %>% as.data.frame() %>% 
  rownames_to_column(var = "변수") %>%
  dplyr::select(1, 3, 4, 5, 9, 10) %>% 
  rename(
    관측치 = n, 평균 = mean, 표준편차 = sd, 
    최소값 = min, 최대값 = max) %>% 
  mutate_if(is.numeric, round, 2) %>%
  knitr::kable(
      caption = "주요 변수의 기술통계",
      longtable = T, format = "latex") %>% 
  kableExtra::kable_minimal()
    
```

